{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rahul Gupta\\\\git\\\\lockerroom345website\\\\lockerroom345website\\\\frontend\\\\src\\\\component\\\\Cart\\\\Payment.js\",\n    _s = $RefreshSig$();\n\nimport React, { Fragment, useEffect, useRef } from \"react\";\nimport CheckoutSteps from \"../Cart/CheckoutSteps\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport MetaData from \"../layout/MetaData\";\nimport { Typography } from \"@material-ui/core\";\nimport { useAlert } from \"react-alert\";\nimport ReactToPrint from \"react-to-print\";\nimport PrintIcon from \"@mui/icons-material/Print\";\nimport { CardNumberElement, CardCvcElement, CardExpiryElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport axios from \"axios\";\nimport \"./payment.css\";\nimport CreditCardIcon from \"@material-ui/icons/CreditCard\";\nimport EventIcon from \"@material-ui/icons/Event\";\nimport VpnKeyIcon from \"@material-ui/icons/VpnKey\";\nimport { createOrder, clearErrors } from \"../../actions/orderAction\";\nimport { PDFDownloadLink, Document, Page, pdf } from \"@react-pdf/renderer\";\nimport ConfirmOrder from \"./ConfirmOrder\";\nimport RequestFormReplica from \"./RequestFormReplica\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Payment = _ref => {\n  _s();\n\n  let {\n    history\n  } = _ref;\n  const orderInfo = JSON.parse(sessionStorage.getItem(\"orderInfo\"));\n  const dispatch = useDispatch();\n  const alert = useAlert(); // const stripe = useStripe();\n  // const elements = useElements();\n\n  const payBtn = useRef(null); // const { shippingInfo, cartItems } = useSelector((state) => state.cart);\n\n  const {\n    shippingInfo,\n    cartItems\n  } = useSelector(state => state.cart);\n  const {\n    user\n  } = useSelector(state => state.user);\n  const {\n    error\n  } = useSelector(state => state.newOrder);\n  const paymentData = {\n    amount: Math.round(orderInfo.totalPrice * 100)\n  }; // const upadtedcartItems = localStorage.getItem(\"cartItemss\");\n\n  const submitHandler = async e => {\n    const order = {\n      shippingInfo,\n      orderItems: cartItems,\n      itemsPrice: orderInfo.subtotal,\n      taxPrice: orderInfo.tax,\n      shippingPrice: orderInfo.shippingCharges,\n      totalPrice: orderInfo.totalPrice\n    };\n    e.preventDefault(); // console.log(\"upadtedcartItemspay\",upadtedcartItems);\n\n    console.log(\"cartItems\", cartItems);\n    payBtn.current.disabled = true;\n\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n      const {\n        data\n      } = await axios.post(\"/api/v1/payment/process\", paymentData, config); //const client_secret = data.client_secret;\n      //if (!stripe || !elements) return;\n      // const result = await stripe.confirmCardPayment(client_secret, {\n      //   payment_method: {\n      //     card: elements.getElement(CardNumberElement),\n      //     billing_details: {\n      //       name: user.name,\n      //       email: user.email,\n      //       address: {\n      //         line1: shippingInfo.address,\n      //         city: shippingInfo.city,\n      //         state: shippingInfo.state,\n      //         postal_code: shippingInfo.pinCode,\n      //         country: shippingInfo.country,\n      //       },\n      //     },\n      //   },\n      // });\n      //result.paymentIntent.status === \"succeeded\";\n\n      if (data.success === true && cartItems.length > 0) {\n        // order.paymentInfo = {\n        //   id: result.paymentIntent.id,\n        //   status: result.paymentIntent.status,\n        // };\n        dispatch(createOrder(order));\n        history.push(\"/success\");\n      } else {\n        alert.error(\"No items available in cart. Please try adding the items again\");\n      }\n    } catch (error) {\n      payBtn.current.disabled = false;\n      alert.error(error.response.data.message);\n    }\n  };\n\n  React.useEffect(() => {\n    if (error) {\n      alert.error(error);\n      dispatch(clearErrors());\n    }\n  }, [dispatch, error, alert]);\n  return /*#__PURE__*/_jsxDEV(Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(MetaData, {\n      title: \"Payment\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(CheckoutSteps, {\n      activeStep: 2\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"paymentContainer\",\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        className: \"paymentForm\",\n        onSubmit: e => submitHandler(e),\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          className: \"Typography\",\n          children: \"Order Place\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"submit\",\n          value: `Proceed To Place Order`,\n          ref: payBtn,\n          className: \"paymentFormBtn\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 121,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Payment, \"8GOKcrTvaML0GoWvuePC4Io0iAc=\", false, function () {\n  return [useDispatch, useAlert, useSelector, useSelector, useSelector];\n});\n\n_c = Payment;\nexport default Payment;\n\nvar _c;\n\n$RefreshReg$(_c, \"Payment\");","map":{"version":3,"names":["React","Fragment","useEffect","useRef","CheckoutSteps","useSelector","useDispatch","MetaData","Typography","useAlert","ReactToPrint","PrintIcon","CardNumberElement","CardCvcElement","CardExpiryElement","useStripe","useElements","axios","CreditCardIcon","EventIcon","VpnKeyIcon","createOrder","clearErrors","PDFDownloadLink","Document","Page","pdf","ConfirmOrder","RequestFormReplica","Payment","history","orderInfo","JSON","parse","sessionStorage","getItem","dispatch","alert","payBtn","shippingInfo","cartItems","state","cart","user","error","newOrder","paymentData","amount","Math","round","totalPrice","submitHandler","e","order","orderItems","itemsPrice","subtotal","taxPrice","tax","shippingPrice","shippingCharges","preventDefault","console","log","current","disabled","config","headers","data","post","success","length","push","response","message"],"sources":["C:/Users/Rahul Gupta/git/lockerroom345website/lockerroom345website/frontend/src/component/Cart/Payment.js"],"sourcesContent":["import React, { Fragment, useEffect, useRef } from \"react\";\r\nimport CheckoutSteps from \"../Cart/CheckoutSteps\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport MetaData from \"../layout/MetaData\";\r\nimport { Typography } from \"@material-ui/core\";\r\nimport { useAlert } from \"react-alert\";\r\nimport ReactToPrint from \"react-to-print\";\r\nimport PrintIcon from \"@mui/icons-material/Print\";\r\nimport {\r\n  CardNumberElement,\r\n  CardCvcElement,\r\n  CardExpiryElement,\r\n  useStripe,\r\n  useElements,\r\n} from \"@stripe/react-stripe-js\";\r\n\r\nimport axios from \"axios\";\r\nimport \"./payment.css\";\r\nimport CreditCardIcon from \"@material-ui/icons/CreditCard\";\r\nimport EventIcon from \"@material-ui/icons/Event\";\r\nimport VpnKeyIcon from \"@material-ui/icons/VpnKey\";\r\nimport { createOrder, clearErrors } from \"../../actions/orderAction\";\r\nimport { PDFDownloadLink, Document, Page, pdf } from \"@react-pdf/renderer\";\r\nimport ConfirmOrder from \"./ConfirmOrder\";\r\nimport RequestFormReplica from \"./RequestFormReplica\";\r\n\r\nconst Payment = ({ history }) => {\r\n  const orderInfo = JSON.parse(sessionStorage.getItem(\"orderInfo\"));\r\n\r\n  const dispatch = useDispatch();\r\n  const alert = useAlert();\r\n  // const stripe = useStripe();\r\n  // const elements = useElements();\r\n  const payBtn = useRef(null);\r\n\r\n  // const { shippingInfo, cartItems } = useSelector((state) => state.cart);\r\n  const { shippingInfo, cartItems } = useSelector((state) => state.cart);\r\n  const { user } = useSelector((state) => state.user);\r\n  const { error } = useSelector((state) => state.newOrder);\r\n\r\n  const paymentData = {\r\n    amount: Math.round(orderInfo.totalPrice * 100),\r\n  };\r\n  // const upadtedcartItems = localStorage.getItem(\"cartItemss\");\r\n\r\n  const submitHandler = async (e) => {\r\n    const order = {\r\n      shippingInfo,\r\n      orderItems: cartItems,\r\n      itemsPrice: orderInfo.subtotal,\r\n      taxPrice: orderInfo.tax,\r\n      shippingPrice: orderInfo.shippingCharges,\r\n      totalPrice: orderInfo.totalPrice,\r\n    };\r\n\r\n    e.preventDefault();\r\n    // console.log(\"upadtedcartItemspay\",upadtedcartItems);\r\n    console.log(\"cartItems\", cartItems);\r\n    payBtn.current.disabled = true;\r\n\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      };\r\n      const { data } = await axios.post(\r\n        \"/api/v1/payment/process\",\r\n        paymentData,\r\n        config\r\n      );\r\n\r\n      //const client_secret = data.client_secret;\r\n\r\n      //if (!stripe || !elements) return;\r\n\r\n      // const result = await stripe.confirmCardPayment(client_secret, {\r\n      //   payment_method: {\r\n      //     card: elements.getElement(CardNumberElement),\r\n      //     billing_details: {\r\n      //       name: user.name,\r\n      //       email: user.email,\r\n      //       address: {\r\n      //         line1: shippingInfo.address,\r\n      //         city: shippingInfo.city,\r\n      //         state: shippingInfo.state,\r\n      //         postal_code: shippingInfo.pinCode,\r\n      //         country: shippingInfo.country,\r\n      //       },\r\n      //     },\r\n      //   },\r\n      // });\r\n      //result.paymentIntent.status === \"succeeded\";\r\n\r\n      if (data.success === true && cartItems.length > 0) {\r\n        // order.paymentInfo = {\r\n        //   id: result.paymentIntent.id,\r\n        //   status: result.paymentIntent.status,\r\n        // };\r\n        dispatch(createOrder(order));\r\n        history.push(\"/success\");\r\n      } else {\r\n        alert.error(\r\n          \"No items available in cart. Please try adding the items again\"\r\n        );\r\n      }\r\n    } catch (error) {\r\n      payBtn.current.disabled = false;\r\n      alert.error(error.response.data.message);\r\n    }\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (error) {\r\n      alert.error(error);\r\n      dispatch(clearErrors());\r\n    }\r\n  }, [dispatch, error, alert]);\r\n\r\n  return (\r\n    <Fragment>\r\n      <MetaData title=\"Payment\" />\r\n      <CheckoutSteps activeStep={2} />\r\n      <div className=\"paymentContainer\">\r\n        <form className=\"paymentForm\" onSubmit={(e) => submitHandler(e)}>\r\n          <Typography className=\"Typography\">Order Place</Typography>\r\n          <hr></hr>\r\n          <br />\r\n          <br />\r\n          <input\r\n            type=\"submit\"\r\n            value={`Proceed To Place Order`}\r\n            ref={payBtn}\r\n            className=\"paymentFormBtn\"\r\n          />\r\n        </form>\r\n      </div>\r\n    </Fragment>\r\n  );\r\n};\r\n\r\nexport default Payment;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}